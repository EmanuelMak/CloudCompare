image: inf-docker.fh-rosenheim.de/sinfemmakk/cloudcompare:latest

stages:
  - init
  - build
  - test

setVaultEnv:
  stage: init
  script:
    - vlt login
    - vlt config

testAWSCLI:
  stage: init
  script:
    - aws --version
    - vlt run --command="make -f Makefile.ci checkAwsLggedIn"

deployCamelCaseConverterMavenToRegistry:
  image: inf-docker.fh-rosenheim.de/sinfemmakk/cloudcompare/jdkmvn:latest
  stage: build
  script:
    - cd ./src/camelCase
    - vlt run --command="make -f makefile.ci deployToGitlabPackageRegistry"

test-variables:
  stage: init
  script:
   - vlt secrets
   - make -f Makefile.ci test
   - vlt run --command="make -f Makefile.ci testEnvSecrets"


pipeline_job:
  script:
    - echo "This job runs only when files in $CI_PROJECT_DIR/pipeline/* are modified."
  rules:
    - if: '$CI_COMMIT_BRANCH'
      changes:
        - $CI_PROJECT_DIR/pipeline/**